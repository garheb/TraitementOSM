package test;

import java.io.BufferedWriter;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.json.Json;
import javax.json.JsonArray;
import javax.json.JsonArrayBuilder;
import javax.json.JsonBuilderFactory;
import javax.json.JsonObjectBuilder;
import model.GestionXML;
import model.Node;
import model.TypeShape;
import model.Way;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;
import org.xml.sax.XMLReader;
import org.xml.sax.helpers.XMLReaderFactory;

public class Traitement {
    private final double _minX = 0.09;
    private final double _minY = 49.448;
    private final double _limiteX = 0.2100875;
    private final double _limiteY = 49.492;
    
    private final long[] littoraux = new long[] {22340991, 22762633, 22762667, 22762669, 22895525, 22895539, 24586929, 24586931, 27467272, 31287089, 32066795, 32067277, 32067284, 32067288, 32067293, 32067603, 34397398, 42236483, 42255666, 47895174, 48199393, 48199415, 48290026, 48290278, 48361284, 48466900, 48502075, 48502079, 48565664, 48565689, 48565720, 48565745, 49696351, 49696353, 49696354, 49696355, 49697603, 49697604, 50563139, 50655178, 56184819, 63203811, 63203813, 63203814, 63203815, 63203818, 63203823, 63203825, 63203827, 63203830, 63203831, 63203834, 63203836, 63203837, 63203839, 63203844, 63203847, 63203849, 63203850, 63203853, 63203856, 63203857, 63203859, 63203861, 63203863, 63203865, 63203870, 63203872, 63203874, 63203876, 63204237, 63204238, 63204239, 63204240, 63204241, 63204242, 63204243, 63204244, 63204245, 63204246, 63204247, 63204248, 63204249, 63204250, 63204251, 63204252, 63204253, 63204254, 63204255, 63204256, 63204257, 63204258, 63204259, 63204260, 63204261, 63204262, 63204263, 63204264, 63204266, 63204268, 63204269, 63204270, 63204271, 63204272, 63204273, 63204274, 63204275, 63204276, 63204277, 63204278, 63204279, 63204280, 63204281, 63204282, 63204508, 63204793, 63204794, 63204795, 63204796, 63204797, 63204798, 63204799, 63204800, 63204801, 63204802, 63204803, 63204804, 63204805, 63204806, 63204807, 63204808, 63204809, 63204810, 63204811, 63204812, 63204813, 63204814, 63204815, 63204816, 63204817, 63204818, 63204819, 63204820, 63204821, 63204822, 63204824, 63204825, 63204826, 63204827, 63204828, 63204829, 63204830, 63204831, 63204832, 63204833, 63204834, 63206736, 63206742, 63206745, 63206747, 63206750, 63206752, 63206755, 63206758, 63206760, 63206767, 63206775, 63206777, 63206781, 63206789, 63206791, 63206795, 63206806, 63206813, 63206814, 63206817, 63206825, 63206828, 63206830, 63206836, 63206840, 63206848, 63206851, 63206853, 63206858, 63206860, 63206862, 63206864, 63206865, 63206867, 63206869, 63206873, 63206879, 63206882, 63206885, 63206892, 63206897, 63206899, 63206902, 63206903, 63206906, 69728930, 69728931, 69728932, 69728933, 69728934, 69728935, 69728936, 69728937, 69728939, 69728940, 69728941, 69728942, 69728943, 69728944, 69728945, 69728947, 69728949, 69728950, 69728951, 69728952, 69728953, 69728954, 69728955, 69728957, 69728958, 69728959, 69728960, 69728962, 69728963, 69728965, 69728966, 69728967, 69729796, 69729797, 69729798, 69729799, 69729800, 69729801, 69729802, 69729803, 69729804, 69729805, 69729806, 69729807, 69729808, 69729809, 69729810, 69729811, 69729812, 69729813, 69729814, 69729815, 69729816, 69729817, 69729818, 69729820, 69729821, 69729822, 69729823, 69729824, 69729825, 69729826, 69729827, 69729828, 69729829, 69729830, 69729831, 69729832, 69729833, 69729834, 69729835, 69729836, 69729837, 69729838, 69729839, 69729840, 69729841, 69729842, 69729843, 69729844, 69729845, 69729846, 69729847, 69729848, 69729849, 69729850, 69729851, 69729852, 69729853, 69729854, 69729855, 69729856, 69729857, 69729858, 69729859, 69729860, 69729863, 69729864, 69729865, 69729867, 69729868, 69729870, 69729873, 69729875, 69729876, 69729878, 69729880, 69729881, 69729882, 69729883, 69729884, 69729885, 69729886, 69729887, 69729888, 69729889, 69729892, 69729897, 69729901, 69729906, 69729909, 69729910, 69729912, 69729913, 69729917, 69729919, 69729922, 69729925, 69729926, 69729928, 69729929, 69735723, 69735725, 69735728, 69735730, 69735732, 69735735, 69735736, 69735737, 69735741, 69735743, 69735746, 69735747, 69735748, 69735751, 69735753, 69735754, 69735756, 69735759, 69735761, 69735764, 69735767, 69735769, 69735771, 69735775, 69735777, 69735779, 69735781, 69735782, 69735784, 69735786, 69735788, 69735789, 69735791, 69735793, 69735795, 69735797, 69735799, 69735801, 69735802, 69735806, 69735809, 69735810, 69735813, 69735814, 69735816, 69735817, 69735820, 69735823, 69735824, 69735826, 69735828, 69735832, 69735833, 69735834, 69735837, 69735839, 69735842, 69735844, 69735845, 69735846, 69735848, 69735851, 69735853, 69735855, 69735858, 69735859, 69735863, 69735864, 69735867, 69735868, 69735871, 69735872, 69735875, 69735876, 69735878, 69735881, 69735883, 69735885, 69735889, 69735896, 69735901, 69735905, 69735908, 69735910, 69735914, 69735919, 69735922, 69735926, 69735929, 69735931, 69735932, 69735935, 69735938, 69735940, 69735942, 69735945, 69735946, 69735947, 69735949, 69735952, 69735953, 69735956, 69735958, 69735961, 69735964, 69735966, 69735968, 69735970, 69735971, 69735976, 69735977, 69735979, 69735984, 69735987, 69735992, 69735993, 69735996, 69735998, 69736000, 69736001, 69736004, 69736008, 69736009, 69736012, 69736014, 69736015, 69736018, 69736022, 69736024, 69736026, 69736028, 69736031, 69736032, 69736037, 69736043, 69736045, 69736047, 69736049, 69860588, 69860589, 69860592, 69860593, 69860598, 69860600, 69860604, 69860606, 69860609, 69860610, 69860614, 69860616, 69860617, 69860621, 69860622, 69860626, 69860627, 69860630, 69860632, 69860635, 69860639, 69860640, 69860644, 69860645, 69860646, 69862992, 69862993, 69862994, 69862995, 69862996, 69862997, 69862999, 69863000, 69863002, 69863004, 69863005, 69863006, 69863007, 69863008, 69863009, 69863010, 69863011, 69863012, 69863014, 69863015, 69863016, 69863018, 69863019, 69863020, 69863021, 69863022, 69863023, 69863024, 69863025, 69863026, 69863027, 69863028, 69863030, 69863031, 69863032, 69863033, 69863034, 69863035, 69863036, 69863037, 69863038, 69863039, 69863040, 69863041, 69863042, 69863043, 69863044, 69863045, 69863046, 69863047, 69863048, 69863049, 69863050, 69863052, 69863053, 69863054, 69863055, 69863056, 69863058, 69863059, 69863060, 69863061, 69863062, 69863063, 69863064, 69863065, 69863066, 69863067, 69863068, 69863069, 69863070, 69863072, 69863074, 69863075, 69863077, 69863079, 69863080, 69863081, 69863082, 69863083, 69863084, 69863085, 69863086, 69863087, 69863088, 69863089, 69863090, 69863092, 69863093, 69863094, 69863096, 69863097, 69863098, 69863099, 69863100, 69863101, 69863102, 69863103, 69863107, 69863108, 69863109, 69863110, 69863111, 69863112, 69863113, 69863115, 69863116, 69863118, 69863119, 69863120, 69863121, 69863123, 69863124, 69863125, 69863126, 69863130, 69863131, 69863132, 69863133, 69863134, 69863135, 69863136, 69863137, 69863138, 69863139, 69875649, 69875654, 69875656, 69875659, 69875660, 69875662, 69875664, 69875674, 69875675, 69875677, 69875680, 69875684, 69875688, 69875689, 69875692, 69875695, 69875697, 69875709, 69875710, 69875711, 69875712, 69875713, 69875714, 69875715, 69875716, 69875720, 69875724, 69875725, 69875726, 69875727, 69875728, 69875729, 69875730, 69875731, 69875732, 69875733, 69875734, 69875738, 69875740, 69875743, 69875744, 69875747, 69875748, 69875749, 69875750, 69875754, 69875757, 69875759, 69875760, 69875762, 69875763, 69875764, 69875765, 69875769, 69875771, 69875772, 69875776, 69875777, 69875778, 69875779, 69875780, 69875781, 69875783, 69875785, 69875796, 69875799, 69875800, 69875801, 69875804, 69875806, 69875807, 69875809, 69875814, 69875819, 69875823, 69875825, 69875826, 69875827, 69875828, 69875829, 69875830, 69875831, 69875832, 69875835, 69875837, 69875838, 69875840, 69875841, 69875842, 69875843, 69875844, 69875845, 69875846, 69875847, 69875848, 69875851, 69875853, 69875855, 69875856, 69875860, 69875861, 69875862, 69875866, 69875868, 69875871, 69875873, 69875875, 69875877, 69875879, 69875880, 69875881, 69875882, 69875884, 69875886, 69875888, 69875890, 69875891, 69875892, 69875893, 69875894, 69875895, 69875896, 69879684, 69879687, 69879690, 69879693, 69879694, 69879695, 69879699, 69879701, 69879704, 69879707, 69879709, 69881986, 69881990, 69881993, 69881996, 69881999, 69882002, 69882005, 69882010, 69882013, 69882018, 69882020, 69882024, 69882027, 69882030, 69882031, 69882035, 69882039, 69882041, 69882042, 69882045, 69882047, 69882051, 69882055, 69882060, 69882062, 69882063, 69882065, 69882067, 69882069, 69882073, 69882076, 69882080, 69882082, 69882083, 69882086, 69882090, 69882093, 69882102, 69882103, 69882106, 69882107, 69882110, 69882117, 69882125, 69882129, 69882133, 69882135, 69882137, 69882141, 69882143, 69882148, 69882149, 69882151, 69882153, 69882154, 69882160, 69882161, 69882165, 69882168, 69882171, 69882172, 69882175, 69882176, 69882179, 69882183, 69882188, 69882192, 69882195, 69882198, 69882199, 69882200, 69882204, 69882208, 69882212, 69882215, 69882217, 69882220, 69882221, 69882224, 69882225, 69882228, 69882229, 69882231, 69882233, 69882236, 69882239, 69882240, 69882243, 69882244, 69882248, 69882250, 69882252, 69882254, 69882256, 69882259, 69882261, 69885745, 69885746, 69885751, 69885752, 69885753, 69885754, 69885755, 69885756, 69885760, 69885761, 69885762, 69885763, 69885765, 69885767, 69885776, 69885778, 69885779, 69885780, 69885781, 69885782, 69885783, 69885789, 69885791, 69885792, 69885793, 69885798, 69885801, 69885802, 69885803, 69885804, 69885812, 69885813, 69885819, 69885820, 69885821, 69885823, 69885824, 69885825, 69885826, 69885832, 69885836, 69885838, 69885840, 69885843, 69885844, 69885845, 69885848, 69885850, 69885851, 69885853, 69885854, 69885860, 69885861, 69885863, 69885865, 69885868, 69885878, 69885881, 69885884, 69885886, 69885887, 69885890, 69885893, 69885894, 69885896, 69885897, 69885898, 69885899, 69885903, 69885904, 69885910, 69885912, 69885913, 69885916, 69885917, 69885918, 69885919, 69885923, 69885925, 69885926, 69885929, 69885934, 69885937, 69885939, 69885947, 69885954, 69885955, 69885957, 69885959, 69885960, 69885962, 69885963, 69885967, 69885968, 69885971, 69885972, 69885976, 69885978, 69885982, 69885985, 69885988, 69885990, 69885991, 69885994, 69885999, 69886002, 69886005, 69886006, 69886007, 69886008, 69886010, 69886011, 69886013, 69886014, 69886016, 69886017, 69886021, 69886022, 69886023, 69886024, 69886027, 69886030, 69886037, 69886039, 69886041, 69886045, 69886046, 69886047, 69886048, 69886049, 69886050, 69886057, 69886058, 69886059, 69886060, 69886062, 69886065, 69886067, 69886068, 69886071, 69886074, 69886075, 69886077, 69886087, 69886088, 69886091, 69886096, 69886098, 69886099, 69886101, 69886102, 69886103, 69886105, 69886106, 69886108, 69886110, 69886116, 69886119, 69886120, 69886121, 69886123, 69886125, 69886132, 69886134, 69886136, 69886144, 69886150, 69886157, 69886163, 69886171, 69886172, 69886175, 69886179, 69886181, 69886189, 69886193, 69886195, 69886203, 69886205, 69886207, 69886211, 69886216, 69886217, 69886223, 69886226, 69886232, 69886235, 69886239, 69886245, 69886248, 69886255, 69886257, 69886259, 69886260, 69886261, 69886262, 69886264, 69886266, 69886267, 69886268, 69886269, 69886272, 69886273, 69886274, 69886275, 69886277, 69886278, 69886279, 69886281, 69886282, 69886285, 69886287, 69886289, 69886290, 69886292, 69886295, 69886299, 69886300, 69886302, 69886304, 69886305, 69886306, 69886309, 69886318, 69886320, 69886321, 69886325, 69886326, 69886327, 69886332, 69886333, 69886334, 69886336, 69886337, 69886339, 69886340, 69886341, 69886342, 69886348, 69886350, 69886352, 69886353, 69886354, 69886358, 69886359, 69886360, 69886362, 69886366, 69886367, 69886372, 69886373, 69886375, 69886380, 69886386, 69886389, 69886392, 69886394, 69886396, 69886397, 69886398, 69886399, 69886400, 69886405, 69886410, 69886412, 69886415, 69886417, 69886419, 69886420, 69886421, 69886422, 69886423, 69886424, 69886431, 69886433, 69886436, 69886442, 69886443, 69886445, 69886451, 69886452, 69886454, 69886458, 69886459, 69886462, 69886465, 69886471, 69886477, 69886481, 69886484, 69886488, 69886489, 69886493, 69886495, 69886496, 69886498, 69886505, 69886506, 69886511, 69886513, 69886514, 69886515, 69886518, 69886520, 69886521, 69886526, 69886528, 69886529, 69886533, 69886536, 69886543, 69886544, 69886547, 69886550, 69886552, 69886553, 69886554, 69886558, 69886561, 69886562, 69886564, 69886567, 69886569, 69886571, 69886573, 69886574, 69886575, 69886578, 69886581, 69886583, 69886585, 69886587, 69886588, 69886589, 69886590, 69886591, 69886593, 69886594, 69886596, 69886598, 69886602, 69886607, 69886608, 69886610, 69886611, 69886612, 69886613, 69886614, 69886615, 69886616, 69886618, 69886619, 69886622, 69886624, 69886626, 69886630, 69886631, 69886632, 69886634, 69886635, 69886638, 69886639, 69886640, 69886641, 69886643, 69886646, 69886647, 69886648, 69886649, 69886650, 69886651, 69886653, 69886655, 69886656, 69886659, 69886660, 69886661, 69886666, 69886668, 69886669, 69886670, 69886672, 69886674, 69886676, 69886679, 69886681, 69886682, 69886684, 69886685, 69886686, 69886687, 69886690, 69886691, 69886695, 69886698, 69886699, 69886700, 69886701, 69886702, 69886704, 69886705, 69886708, 69886713, 69886719, 69886724, 69886727, 69886728, 69886730, 69886731, 69886733, 69886735, 69886737, 69886738, 69886739, 69886741, 69886742, 69886748, 69886750, 69886753, 69886754, 69886755, 69886757, 69886759, 69886761, 69886762, 69886763, 69886767, 69886769, 69886773, 69886774, 69886776, 69886777, 69886778, 69886779, 69886780, 69886786, 69886792, 69886793, 69886795, 69886798, 69886801, 69886802, 69886808, 69886822, 69886827, 69886830, 69886835, 69886841, 69886847, 69886855, 69886857, 69886860, 69886871, 69886884, 69886886, 69886889, 69886893, 69886894, 69886895, 69886899, 69886901, 69886911, 69886912, 69886915, 69886917, 69886920, 69886921, 69886922, 69886924, 69886928, 69886929, 69886932, 69886934, 69886935, 69886936, 69886937, 69886938, 69886943, 69886944, 69886946, 69886948, 69886954, 69886962, 69886964, 69886965, 69886966, 69886967, 69886969, 69886970, 69886972, 69886973, 69886977, 69886979, 69886980, 69886984, 69886985, 69886986, 69886988, 69886990, 69886993, 69886996, 69887005, 69887006, 69887010, 69887011, 69887014, 69887015, 69887016, 69887020, 69887023, 69887025, 69887030, 69887031, 69887032, 69887033, 69887035, 69887036, 69887037, 69887038, 69887039, 69887040, 69887041, 69887043, 69887044, 69887046, 69887047, 69887049, 69887051, 69887054, 69887055, 69887056, 69887058, 69887060, 69887061, 69887062, 69887065, 69887066, 69887067, 69887068, 69887070, 69887074, 69887075, 69887077, 69887078, 69887079, 69887080, 69887081, 69887082, 69887084, 69887087, 69887088, 69887090, 69887091, 69887094, 69887096, 69887100, 69887103, 69887109, 69887110, 69887111, 69887113, 69887116, 69887119, 69887121, 69887126, 69887127, 69887129, 69887131, 69887132, 69887133, 69887134, 69887136, 69887138, 69887142, 69887143, 69887144, 69887148, 69887151, 69887152, 69887154, 69887159, 69887160, 69887163, 69887166, 69887167, 69887169, 69887172, 69887174, 69887175, 69887178, 69887180, 69887181, 69887183, 69887184, 69887186, 69887189, 69887190, 69980877, 69980881, 69980884, 69980886, 69980888, 69980891, 69980895, 69980897, 69980900, 69980902, 69980903, 69980905, 69980908, 69980912, 69980917, 69980920, 69980921, 69980923, 69980925, 69980927, 69980929, 69980930, 69980932, 69980934, 69980942, 69980943, 69980946, 69980951, 69980953, 69980955, 69980957, 69980960, 69980963, 69980966, 69980970, 69980974, 69980979, 69980981, 69980984, 69980985, 69980987, 69980989, 69980992, 69980993, 69980998, 69981007, 69981009, 69981014, 69981015, 69981017, 69981023, 69981039, 69981040, 69981043, 69981047, 69981051, 69981056, 69981062, 69981063, 69981070, 69981073, 69981075, 69981084, 69981093, 69981095, 69981101, 69981107, 69981108, 69981112, 69981114, 69981129, 69981133, 69981138, 69981140, 69981142, 69981145, 69981147, 69981150, 69981152, 69981155, 69981159, 69981161, 69981165, 69981167, 69981177, 69981183, 69981190, 69981192, 69981197, 69981214, 69981218, 69981219, 69981250, 69981252, 69981255, 69981258, 69981259, 69981261, 69981263, 69981267, 69981272, 69981278, 69981279, 69981298, 69981300, 69981303, 69981311, 69981312, 69981314, 69981321, 69981330, 69981344, 69981345, 69981347, 69981355, 69981357, 69981363, 69981366, 69981381, 69981382, 69981387, 69981389, 69981393, 69981399, 69981400, 69981403, 69981408, 69981412, 69981415, 69981419, 69981420, 69981422, 69981433, 69981442, 69981448, 69981453, 69981457, 69981460, 69981461, 69981466, 69981469, 69981471, 69981473, 69981474, 69981480, 69981487, 69981491, 69981493, 69981499, 69981502, 69981503, 69981509, 69981512, 69981514, 69981521, 69981527, 69981531, 69981535, 69981538, 69981542, 69981545, 69981546, 69981551, 69981553, 69981557, 69981563, 69981565, 69981571, 69981572, 69981576, 69981577, 69981582, 69981598, 69981602, 69981604, 69981610, 69981611, 69981613, 69981615, 69981626, 69981628, 69981634, 69981639, 69981643, 69981646, 69981650, 69981656, 69981658, 69981662, 69981664, 69981665, 69981667, 69981670, 69981672, 69981673, 69981677, 69981678, 69981680, 69981683, 69981684, 69981689, 69981692, 69981694, 69981695, 69981696, 69981699, 69981705, 69981711, 69981713, 69981720, 69981723, 69981724, 69981725, 69981728, 69981730, 69981732, 69981736, 69981750, 69981755, 69981757, 69981758, 69981764, 69981765, 69981766, 69981770, 69981773, 69981775, 69981778, 69981780, 69981784, 69981785, 69981787, 69981791, 69981793, 69981797, 69981801, 69981808, 69981809, 69981812, 69981813, 69981817, 69985531, 69985534, 69985548, 69985578, 69985602, 69985616, 69985622, 69985646, 69985701, 69985703, 69985732, 69985744, 69985761, 69985765, 69985781, 69985784, 69985787, 69985790, 69985805, 69985826, 69985837, 69985864, 69985868, 69985877, 69985921, 69985971, 69986021, 69986030, 69986033, 69986037, 69986051, 69986064, 69986066, 69986088, 69986102, 69986119, 69986133, 69986147, 69986168, 69986186, 69986197, 69986209, 69986236, 69986251, 69986274, 69986397, 69986400, 69986417, 69986432, 70012491, 70014439, 70014869, 70398069, 70406583, 70406741, 70406742, 70406745, 70406746, 70406749, 70406750, 70406752, 71155274, 71155277, 71155278, 71155279, 71157014, 71228724, 71290790, 71290791, 71809965, 71961783, 71961787, 71961788, 71961789, 71961790, 71961791, 71961796, 71963288, 71963289, 71963290, 71965612, 71965614, 72051040, 72051041, 72051157, 73833102, 73833103, 73882628, 73882629, 73882630, 73910707, 73910708, 73910709, 73910710, 73910711, 73910712, 73910713, 73910714, 73910716, 73910718, 73910719, 73910722, 73910723, 73910724, 73910725, 73910728, 73913536, 73913537, 73913538, 73913539, 73913540, 73914065, 73914067, 73914069, 73914071, 73914072, 73916013, 74086290, 74086294, 74086295, 74086298, 74095321, 74146837, 74156769, 74156770, 74156771, 74175003, 74175004, 74175052, 74183525, 74183528, 74183530, 74183531, 74183536, 74183538, 74183540, 74183542, 74183543, 74183544, 74183548, 74183549, 74183552, 74183555, 74183557, 74183560, 74183561, 74187395, 74187396, 74187397, 74187398, 74187399, 74187401, 74187402, 74187787, 74187790, 74250549, 74395533, 74518075, 74528998, 74543521, 74543522, 74547206, 74737991, 74737993, 74737994, 74737998, 74738000, 74738001, 74738003, 74738005, 74738008, 74738009, 74738010, 74738013, 74738014, 74738016, 74738019, 74738020, 74738022, 74738025, 74738027, 74738030, 74738031, 74738032, 74738033, 74738036, 74985474, 74985481, 74985482, 74985483, 74985487, 74985491, 74988327, 74988332, 74992413, 74996155, 75000751, 75000753, 75000757, 75000761, 75000762, 75001211, 75055023, 75055025, 75255458, 75271186, 75277921, 87723865, 87723866, 87723868, 87723870, 87754208, 87755854, 87755856, 87755860, 87755862, 87755869, 87758506, 87758510, 87758514, 87758517, 87758520, 87758521, 87760753, 87761509, 87761510, 87761513, 87766914, 87766917, 87766948, 87766953, 87766965, 87770961, 87770963, 87770967, 87770969, 87770977, 87770980, 87770986, 87770987, 87772107, 87788066, 87788068, 87788069, 87825132, 87825135, 87825149, 87825151, 87825153, 87825155, 87825470, 87849996, 87849997, 87849999, 87850765, 87860880, 87868092, 87868098, 87868103, 87868106, 87868114, 87868122, 87868124, 87868130, 87868132, 87868140, 87868143, 87868147, 87868148, 87868151, 87870735, 87870738, 87870742, 87870744, 89551672, 89551674, 89551675, 108777752, 108777754, 108777755, 108777757, 108777758, 108777759, 113586130, 113586131, 113586132, 113586133, 113586134, 113586687, 113586688, 113586689, 124825645, 124825646, 124825649, 124825650, 124825652, 124825653, 124825655, 124825659, 124825660, 124825661, 124825662, 124825663, 124825664, 124825665, 124825667, 124825670, 124825671, 124825674, 124825677, 124852599, 124852603, 124852612, 124852625, 124852648, 124852659, 124852707, 124852712, 124852714, 124852756, 124852813, 124852817, 124852821, 124852825, 124852827, 124852837, 124852840, 124852843, 124852847, 124852849, 124852852, 124852856, 124852861, 124852865, 124852881, 124852893, 124852914, 124852940, 124852942, 124852947, 124852967, 124852971, 124852973, 124852975, 124852984, 124852985, 124852986, 124852989, 124853010, 124853017, 124853041, 124853044, 124853046, 124853050, 124853055, 124853057, 124853070, 124853074, 124853079, 124853080, 124853084, 124853094, 124853544, 124853568, 125162430, 125162431, 125162435, 125162439, 125162445, 125162451, 125162499, 125162500, 125162501, 125162502, 125162503, 125162504, 125162505, 125162934, 125162936, 125162940, 125162986, 125162987, 125162989, 125162990, 125162991, 125162994, 125162996, 125162997, 125162998, 125162999, 125163002, 125163003, 125163004, 125163005, 125163006, 125163040, 125163041, 125163042, 125163115, 125163116, 125163117, 125163118, 125163260, 125163263, 125163269, 125163343, 125164435, 125164436, 125164438, 125164439, 125164441, 125164442, 125164443, 125164444, 125164445, 125164446, 125164448, 125164450, 125164451, 125164453, 125164454, 125164455, 125164456, 125164458, 125164459, 125164460, 125164461, 125164462, 125164463, 125164465, 125164466, 125164467, 125164468, 125164469, 125164470, 125164622, 125166538, 125166539, 125166540, 125166541, 125166542, 125166543, 125166544, 125166545, 125166546, 125166548, 125166549, 125166550, 125166552, 125166553, 125166555, 125166556, 125166558, 125166559, 125166560, 125166562, 125166564, 125166566, 125166569, 125166570, 125166572, 125166576, 125166577, 125166581, 125166582, 125166586, 125166589, 125166591, 125166594, 125166596, 125166600, 125166601, 125166605, 125166606, 125166611, 125166615, 125166727, 125166728, 125168626, 125168628, 125168629, 125168630, 125168633, 125168635, 125168638, 125168641, 125168644, 125168646, 125168648, 125168651, 125168653, 125168658, 125168661, 125168666, 125168668, 125168672, 125168675, 125168680, 125168685, 125168687, 125168693, 125168694, 125168697, 125168700, 125168701, 125168707, 125168709, 125168711, 125168713, 125168715, 125168720, 125168722, 125168723, 125168725, 125168726, 125168729, 125168731, 125168732, 125168734, 125168736, 125168738, 125168740, 125168742, 125168743, 125168744, 125168748, 125168749, 125168752, 125168755, 125168757, 125168758, 125168762, 125168766, 125168768, 125168770, 125168771, 125168772, 125186337, 125186341, 125186343, 125187393, 125187402, 125187405, 125187759, 125201891, 125201895, 125212518, 125212520, 125212529, 125212530, 125212531, 125212532, 125212533, 125212535, 125212537, 125212538, 125212540, 125212542, 125212543, 125219110, 125499879, 125501503, 125501504, 125501505, 125501506, 125501507, 125501508, 125501509, 125502821, 125503757, 125505433, 125505880, 125505882, 125505898, 125506990, 125508288, 125508745, 125509899, 125509904, 125509906, 125509908, 125509909, 125509910, 125510133, 126020374, 126020384, 126020397, 126020412, 126020418, 126020491, 126020494, 126020506, 126020507, 126020508, 126098291, 128431342, 128431343, 128431344, 128431356, 128431363, 128431364, 128431365, 128431366, 128431369, 128431374, 128431382, 128431398, 128431399, 128431400, 128431401, 128431402, 128431404, 128431405, 128431407, 128431408, 128431409, 128431410, 128431411, 128431412, 128431413, 128431414, 128431415, 128431418, 128431420, 128431423, 128431426, 128431427, 128431434, 128431435, 128431439, 128431440, 128431441, 128431443, 128431444, 128431445, 128431448, 128431449, 128431857, 128433100, 128433102, 128435170, 129131741, 129131749, 129131756, 129131780, 129131781, 129131782, 129131817, 129131823, 129131826, 129131833, 129131853, 129131869, 129131878, 129131893, 129131909, 129131929, 129248415, 129250103, 132072712, 132072849, 136445142, 137994523, 137994525, 137994527, 137994528, 137994531, 137994532, 151350189, 151352677, 151352678, 151352679, 151352680, 151352685, 151352688, 151352689, 156583711, 156583712, 159990384, 159990385, 159990386, 159990387, 160122635, 160218875, 160218876, 160218877, 160218878, 160218879, 160218880, 163099613, 163099615, 163099616, 163099617, 163099618, 163099619, 163099620, 163099622, 163099623, 163099624, 163099625, 163099626, 163099627, 163102110, 163102111, 163102112, 163102113, 163102115, 163102116, 163102117, 163102118, 163102119, 163102120, 163102121, 163102122, 163102123, 163103034, 163103035, 163103036, 163103037, 163103038, 163103039, 163103040, 163103041, 163103042, 163103043, 163103044, 163103045, 163103046, 163103047, 163103048, 163103049, 163103050, 163103051, 163103052, 163103054, 163103055, 163103056, 163103057, 163103058, 163103059, 163103060, 163103061, 163103062, 163103063, 163103064, 163103065, 163103066, 163103067, 163103068, 163103069, 163103070, 163103071, 163103072, 163103073, 163103074, 163103392, 163103393, 163103744, 163103746, 163103748, 163103750, 163103751, 163103753, 163103754, 163103756, 163103938, 163103939, 163103940, 163105114, 163105115, 163105116, 163105525, 163834058, 163834060, 163834371, 163834372, 163835871, 163835872, 163835873, 163835874, 163835875, 163835876, 163835877, 163835878, 163835879, 163835880, 163835881, 163835882, 163835883, 163835884, 163835885, 163835886, 163835887, 163835888, 163835889, 163841557, 163841558, 163841561, 163841563, 163841564, 164827061, 165515850, 165515851, 166653304, 172701362, 172701363, 173044321, 173109369, 173109370, 174891546, 174891548, 174891551, 174891552, 174891553, 178311328, 178311329, 178311330, 178312789, 178760835, 178760836, 179958536, 179958537, 179959448, 188833567, 190801439, 193199400, 193199401, 193201522, 193201523, 193201524, 193201525, 193201527, 197335656, 197335660, 197335661, 197335664, 197335675, 199291608, 201164764, 201536815, 201536816, 201536817, 201536819, 202007048, 202007050, 202007051, 202007140, 202007561, 202007562, 202007984, 202007985, 202012261, 202012334, 202013122, 202014667, 202167995, 202168027, 202290117, 202290119, 202291586, 202753610, 202753611, 203212058, 203212060, 203212062, 203212718, 203212854, 203212855, 203212897, 204366638, 204366639, 207000663, 207000665, 207000667, 207000668, 207000670, 207000672, 207000677, 207000680, 207000682, 207000685, 207110547, 207342653, 207342654, 207342659, 207367247, 207367256, 207367259, 207367263, 207367272, 207367277, 207367289, 207790763, 207790922, 207790923, 208639117, 210399433, 210399434, 210399435, 230150023, 230150030, 230150032, 230150033, 230189196, 238794741, 238794742, 238794743, 238794744, 238794745, 238794746, 238794747, 238936873, 238936874, 238936875, 238936877, 238936878, 238936879, 238936883, 238936885, 238936887, 238936888, 238936890, 238938845, 238939422, 238939423, 238939424, 238939425, 238939426, 238952064, 238952065, 238953917, 238953918, 238953919, 238953920, 238953921, 238953923, 238953925, 238953926, 238954743, 238954744, 238954745, 238955604, 238955605, 238955606, 238955607, 238955609, 238956493, 238956494, 238956495, 238956496, 238956497, 238957914, 238957917, 238958817, 238958818, 238961415, 238962113, 238962114, 238962115, 238962116, 238963031, 238966542, 238966544, 238966547, 238967184, 238967185, 238967929, 238967930, 238969027, 238969028, 238969029, 238969030, 238969031, 238969032, 238969924, 238969925, 238971756, 238971757, 238971758, 238971759, 238971760, 238971761, 238971762, 238971763, 238971764, 238971765, 238973466, 238973467, 238975704, 238975705, 238975706, 238976448, 238976449, 238976450, 238979137, 238982451, 238982453, 238983220, 238983221, 239753891, 239795724, 239795725, 243168695, 243168697, 243182901, 243267299, 243267300, 243267301, 243309529, 243309598, 247262092, 261353593, 261362482, 261362487, 261362496, 261363802, 261364503, 261472342, 261472343, 261472347, 261472386, 261472401, 261472407, 261472629, 897965451, 897965451, 897965451, 897965451, 897965451};
    private final long[] virer = new long[] {163105116, 71157012, 71155275, 202753633, 71155276, 160121802, 160121802, 71155601, 71155277};
    private JsonArrayBuilder coordConserver = null;
    
    private final String _separateur = java.nio.file.FileSystems.getDefault().getSeparator();
//    private final String _mapXML = "src" + _separateur + "data" + _separateur + "haute-normandie-latest.osm";
//    private final String _output = "src" + _separateur + "data" + _separateur + "map_filtree_4.json";
//    private final String _mapXML = "D:" + _separateur + "NetBeansProjects"+ _separateur + "TraitementOSM" + _separateur + "src" + _separateur + "data"  + _separateur + "haute-normandie-latest.osm";
//    private final String _output = "D:" + _separateur + "NetBeansProjects"+ _separateur + "TraitementOSM" + _separateur + "src" + _separateur + "data"  + _separateur + "map_filtree_4.json";
    private final String _mapXML = "src" + _separateur + "data" + _separateur + "map";
    private final String _output = "src" + _separateur + "data" + _separateur + "map_filtree_5.json";
    private GestionXML _handler;
    public void lireXML() {
        _handler = new GestionXML();
        try {
            XMLReader parser = XMLReaderFactory.createXMLReader();
            parser.setContentHandler(_handler);
            try {
                parser.parse(new InputSource(new FileInputStream(_mapXML)));
                
            } catch (IOException ex) {
                Logger.getLogger(Traitement.class.getName()).log(Level.SEVERE, null, ex);
            }
            
            FileWriter fstream;
            try {
                fstream = new FileWriter(_output);
                try (BufferedWriter out = new BufferedWriter(fstream)) {
//                    JsonGeneratorFactory factory = Json.createGeneratorFactory(null);
//                    JsonGenerator generator = factory.createGenerator(out);
                    JsonBuilderFactory factory = Json.createBuilderFactory(null);
                    
                    JsonArrayBuilder array = factory.createArrayBuilder();
                    for(Way w:_handler.getWays()) {
                        //System.out.println(w.getNodes().size());
                        boolean fill = false;
                        boolean tracer = true;
                        boolean contientPointDansZone = false;
                        boolean tousLesPointsDansZone = true;
                        JsonObjectBuilder job = factory.createObjectBuilder();
                        job.add("_id", w.getId());
                        if(w.getId()==71155279) {
                            job.add("_nom", "Port 2000");
                        } else {
                            job.add("_nom", w.getNom());
                        }
                        
                        if(w.getId()==42236483 || w.getId()==42255666) {
                            job.add("_type", "FORET");
                        } else {
                            job.add("_type", w.getType().toString());
                        }
                        
                        for(long l:littoraux) {
                            if(w.getId()==l) {
                                job.add("_littoral", "TRUE");
                            }
                        }
                        
                        if(w.getType().toString().equals(TypeShape.NATURAL.toString())) {
                            fill = true;
                        } else if(w.getType().toString().equals(TypeShape.TERMINAL.toString())) {
                            fill = true;
                        } else if(w.getType().toString().equals(TypeShape.QUAI.toString())) {
                            fill = true;
                        }
                        //JsonObjectBuilder nodes = factory.createObjectBuilder();
                        JsonArrayBuilder listeCoordonnees = factory.createArrayBuilder();
                        for(Node n:w.getNodes()) {
                            boolean xOk = false;
                            boolean yOk = false;
                            JsonObjectBuilder coordonnees = factory.createObjectBuilder();
                            coordonnees.add("x", n.getLongitude());
                            coordonnees.add("y", n.getLatitude());
                            
                            if(n.getLongitude()>_minX && n.getLongitude()<_limiteX) {
                                xOk = true;
                            }
                            
                            if(n.getLatitude()>_minY && n.getLatitude()<_limiteY) {
                                yOk = true;
                            }
                            if(xOk && yOk) {
                                contientPointDansZone = true;
                                
                            } else {
                                tousLesPointsDansZone = false;
                            }
                            listeCoordonnees.add(coordonnees);
                        }
                        if(w.getId()==71155277) {
                            coordConserver = listeCoordonnees;
                        }
                        
                        if(w.getId()==71155279) {
                            listeCoordonnees = coordConserver;
                        }
                        
                        if(contientPointDansZone) {
                            if(!fill) {
                                if(!tousLesPointsDansZone) {
                                    tracer = false;
                                }
                            }
                        } else {
                            tracer = false;
                        }
                        
                        for(long l:virer) {
                            if(w.getId()==l) {
                                tracer = false;
                            }
                        }
                        
                        job.add("_nodes", listeCoordonnees);
                        if(tracer) {
                            array.add(job);
                        }
                    }
                    JsonArray json = array.build();
                    out.write(json.toString().replace(",", ",\n"));
                }
                fstream.close();
            } catch (IOException ex) {
                Logger.getLogger(Traitement.class.getName()).log(Level.SEVERE, null, ex);
            }
            
            
        } catch (SAXException ex) {
            Logger.getLogger(Traitement.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    
    public static void main(String[] args) {
        Traitement t=new Traitement();
        t.lireXML();
    }
}
